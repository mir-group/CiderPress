

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ciderpress.models.dft_kernel &mdash; CiderPress 0.4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=6c02275b"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ciderpress.models.kernels" href="kernels.html" />
    <link rel="prev" title="ciderpress.models.train" href="train.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/cider_logo_and_name.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/installation.html">Overview and Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory/theory.html">Theory Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../features/features.html">Density and Orbital Features in CiderPress</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dft/dft.html">DFT Module</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="models.html">The Models Module</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="train.html">ciderpress.models.train</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ciderpress.models.dft_kernel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel"><code class="docutils literal notranslate"><span class="pre">DFTKernel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel.mode"><code class="docutils literal notranslate"><span class="pre">DFTKernel.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel.X1ctrl"><code class="docutils literal notranslate"><span class="pre">DFTKernel.X1ctrl</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel.get_k"><code class="docutils literal notranslate"><span class="pre">DFTKernel.get_k()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel.get_k_and_deriv"><code class="docutils literal notranslate"><span class="pre">DFTKernel.get_k_and_deriv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel.get_kctrl"><code class="docutils literal notranslate"><span class="pre">DFTKernel.get_kctrl()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel.map"><code class="docutils literal notranslate"><span class="pre">DFTKernel.map()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel2"><code class="docutils literal notranslate"><span class="pre">DFTKernel2</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ciderpress.models.dft_kernel.DFTKernel2.map"><code class="docutils literal notranslate"><span class="pre">DFTKernel2.map()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kernels.html">ciderpress.models.kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_tools.html">Kernel Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pyscf/pyscf.html">PySCF Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpaw/gpaw.html">GPAW Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c_extensions/c_extensions.html">C Extension Libraries</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CiderPress</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="models.html">The Models Module</a></li>
      <li class="breadcrumb-item active">ciderpress.models.dft_kernel</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/ciderpress/models/dft_kernel.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ciderpress-models-dft-kernel">
<span id="dftkernel"></span><h1>ciderpress.models.dft_kernel<a class="headerlink" href="#ciderpress-models-dft-kernel" title="Link to this heading"></a></h1>
<p>The DFTKernel</p>
<dl class="py class" id="module-ciderpress.models.dft_kernel">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ciderpress.models.dft_kernel.</span></span><span class="sig-name descname"><span class="pre">DFTKernel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiplicative_baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">additive_baseline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ctrl_tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ctrl_nmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel" title="Link to this definition"></a></dt>
<dd><p>This class is used to evaluate kernel functions,
including the baseline X/C energies, for use in the
MOLGP Gaussian process models.</p>
<p>Raw descriptors are denoted X0.
Transformed descriptors are denoted as X1.
Nctrl is the number of control points for the kernel.
N0 is the number of raw features.
N1 is the number of transformed features.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel.mode">
<span class="sig-name descname"><span class="pre">mode</span></span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel.mode" title="Link to this definition"></a></dt>
<dd><p>One of (SEP, POL, OSPOL, SSPOL, NPOL).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel.X1ctrl">
<span class="sig-name descname"><span class="pre">X1ctrl</span></span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel.X1ctrl" title="Link to this definition"></a></dt>
<dd><p>Control points for kernel.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Nctrl, N1</p>
</dd>
</dl>
</dd></dl>

<p>Note on the baselines: Two baseline function
callables are passed to __init__:
multiplicative_baseline and additive_baseline.
The ML part of the XC energy is
<code class="docutils literal notranslate"><span class="pre">multiplicative_baseline</span> <span class="pre">*</span> <span class="pre">gp</span> <span class="pre">+</span> <span class="pre">additive_baseline</span></code>,
where <code class="docutils literal notranslate"><span class="pre">gp</span></code> is the raw output of the Gaussian process.
See <code class="docutils literal notranslate"><span class="pre">ciderpress.dft.baselines</span></code> for details on the
options for this argument.</p>
<p>Some notation notes:</p>
<ul class="simple">
<li><p>k: kernel</p></li>
<li><p>dkdX0T: kernel derivative with respect to raw features.</p></li>
<li><p>m: Multiplicative baseline</p></li>
<li><p>a: Additive baseline</p></li>
<li><p>dm: Derivative of multiplicative baseline wrt features</p></li>
<li><p>da: Derivative of additive baseline wrt features</p></li>
</ul>
<p>SEP array shapes:</p>
<ul class="simple">
<li><p>k: (Nctrl, nspin, Nsamp)</p></li>
<li><p>m and a: (nspin, Nsamp)</p></li>
<li><p>dkdX0T: (Nctrl, nspin, N0, Nsamp)</p></li>
<li><p>dm and da: (nspin, N0, Nsamp)</p></li>
</ul>
<p>NPOL and POL array shapes:</p>
<ul class="simple">
<li><p>k: (Nctrl, Nsamp)</p></li>
<li><p>m and a: Nsamp</p></li>
<li><p>dkdX0t: (Nctrl, nspin, N0, Nsamp)</p></li>
<li><p>dm and da: (N0, nspin, Nsamp)</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kernel</strong> (<em>ciderpress.models.kernels.DiffKernelMixin</em>) – An sklearn kernel with the added utility of
being differentiable with respect to its inputs
via the function get_k_and_deriv</p></li>
<li><p><strong>feature_list</strong> (<em>ciderpress.dft.transform_data.FeatureList</em>) – A list of transformations to be performed on the
raw features before feeding them into the kernel
function.</p></li>
<li><p><strong>mode</strong> (<em>str</em>) – Whether the kernel is part of the exchange (“x”),
correlation (“c”), or exchange-correlation (“xc”)
energy.</p></li>
<li><p><strong>multiplicative_baseline</strong> (<em>callable</em>) – This function takes
in the raw features X0T and returns the baseline energy
by which the ML model should be multiplied.</p></li>
<li><p><strong>additive_baseline</strong> (<em>callable</em>) – This function takes in
the raw features X0T and returns the baseline energy
that should be added to the model</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel.get_k">
<span class="sig-name descname"><span class="pre">get_k</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X0T</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel.get_k" title="Link to this definition"></a></dt>
<dd><p>Compute the kernel function between the input samples <code class="docutils literal notranslate"><span class="pre">X0T</span></code>
and the control points stored in this <code class="docutils literal notranslate"><span class="pre">DFTKernel</span></code> object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>X0T</strong> (<em>np.ndarray</em>) – Shape (nspin, nfeat, nsamp), raw feature vector</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Shape (nctrl, nspin, nsamp) for SEP mode, shape</dt><dd><p>(nctrl, nsamp) for NPOL and POL modes. The kernel function
evaluated between the control points and the sample points.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>(np.ndarray)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel.get_k_and_deriv">
<span class="sig-name descname"><span class="pre">get_k_and_deriv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X0T</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel.get_k_and_deriv" title="Link to this definition"></a></dt>
<dd><p>Compute the kernel function between the input samples <code class="docutils literal notranslate"><span class="pre">X0T</span></code>
and the control points stored in this <code class="docutils literal notranslate"><span class="pre">DFTKernel</span></code> object, along with
the derivative with respect to the input samples.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>X0T</strong> (<em>np.ndarray</em>) – Shape (nspin, nfeat, nsamp), raw feature vector</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Shape (nctrl, nspin, nsamp) for SEP mode, shape</dt><dd><p>(nctrl, nsamp) for NPOL and POL modes. The kernel function
evaluated between the control points and the sample points.</p>
</dd>
<dt>(np.ndarray): Shape (nctrl, nspin, N0, nsamp) for all modes.</dt><dd><p>The derivative of the kernel with result to the sample inputs.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>(np.ndarray)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel.get_kctrl">
<span class="sig-name descname"><span class="pre">get_kctrl</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel.get_kctrl" title="Link to this definition"></a></dt>
<dd><p>Compute the covariance matrix of the control points.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel.map">
<span class="sig-name descname"><span class="pre">map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapping_plan</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel.map" title="Link to this definition"></a></dt>
<dd><p>Must only be called after the model is trained. This function
creates a MappedDFTKernel that evaluates the contribution to
the XC energy from <code class="docutils literal notranslate"><span class="pre">self</span></code>, as well as the derivative of that
XC energy contribution with respect to the raw features X0.
See <code class="docutils literal notranslate"><span class="pre">MappedDFTKernel</span></code> docs for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mapping_plan</strong> (<em>callable</em>) – A function that takes a DFTKernel
object and returns a list of <code class="docutils literal notranslate"><span class="pre">FuncEvaluator</span></code>
instances called <code class="docutils literal notranslate"><span class="pre">fevals</span></code>, that represents the
functions that must be evaluated to compute the XC energy
contribution of <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel2">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ciderpress.models.dft_kernel.</span></span><span class="sig-name descname"><span class="pre">DFTKernel2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiplicative_baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">additive_baseline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ctrl_tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ctrl_nmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel2" title="Link to this definition"></a></dt>
<dd><p>DFTKernel2 is a modification of the DFTKernel object to use a different
approach to constructing the baseline X(C) energy.
DFTKernel2 is build on KernelEvalBase2, which uses libxc to
evaluate XC baselines, as opposed to KernelEvalBase, which
uses the native functions in <code class="docutils literal notranslate"><span class="pre">ciderpress.dft.baselines</span></code>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="ciderpress.models.dft_kernel.DFTKernel2.map">
<span class="sig-name descname"><span class="pre">map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapping_plan</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ciderpress.models.dft_kernel.DFTKernel2.map" title="Link to this definition"></a></dt>
<dd><p>See <code class="docutils literal notranslate"><span class="pre">DFTKernel.map</span></code>.</p>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="train.html" class="btn btn-neutral float-left" title="ciderpress.models.train" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="kernels.html" class="btn btn-neutral float-right" title="ciderpress.models.kernels" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Kyle Bystrom.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #002040;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #002040;
    }
  </style>


</body>
</html>